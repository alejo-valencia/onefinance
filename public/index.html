<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OneFinance Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üìß OneFinance Dashboard</h1>
        <p class="subtitle">Gmail Integration Control Panel</p>
      </header>

      <div id="authSection" class="auth-section">
        <div id="loginPrompt" class="login-prompt">
          <h2>üîê Sign in to continue</h2>
          <p>Only authorized users can access this dashboard.</p>
          <button id="googleSignIn" class="btn btn-google">
            <img
              src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
              alt="Google"
            />
            Sign in with Google
          </button>
          <div id="unauthorizedMessage" class="unauthorized-message hidden">
            <strong>‚ö†Ô∏è Unauthorized Account</strong>
            <p>
              Your email is not authorized to access this dashboard. Please sign
              in with an authorized account.
            </p>
          </div>
        </div>

        <div id="userSection" class="hidden">
          <div class="user-info">
            <img id="userAvatar" class="user-avatar" src="" alt="User" />
            <div>
              <div id="userName" style="color: #fff; font-weight: 600"></div>
              <div id="userEmail" class="user-email"></div>
            </div>
          </div>
          <button id="signOutBtn" class="btn btn-secondary">Sign Out</button>
        </div>
      </div>

      <div id="dashboardContent" class="dashboard-content hidden">
        <div class="endpoints-grid">
          <section class="endpoint-card auth-card">
            <h2>üîê Gmail OAuth</h2>
            <p>Authenticate with Gmail to enable email processing.</p>
            <button
              id="gmailAuthBtn"
              class="btn btn-primary"
              style="width: 100%"
            >
              Authenticate with Gmail
            </button>
            <div id="gmailAuthResult" class="result hidden"></div>
          </section>

          <section class="endpoint-card">
            <h2>üîÑ Renew Watch</h2>
            <p>
              Renew the Gmail watch subscription to continue receiving
              notifications.
            </p>
            <form
              class="endpoint-form"
              data-endpoint="/renewWatch"
              data-method="GET"
            >
              <button type="submit" class="btn btn-primary">
                Renew Watch Subscription
              </button>
            </form>
            <div class="result hidden"></div>
          </section>

          <section class="endpoint-card">
            <h2>üè∑Ô∏è Get Labels</h2>
            <p>List all Gmail labels for the authenticated user.</p>
            <form
              class="endpoint-form"
              data-endpoint="/getLabels"
              data-method="GET"
            >
              <button type="submit" class="btn btn-primary">
                Fetch Labels
              </button>
            </form>
            <div class="result hidden"></div>
          </section>

          <section class="endpoint-card">
            <h2>üì® Test Process Emails</h2>
            <p>Test processing recent emails (for development/testing).</p>
            <form
              class="endpoint-form"
              data-endpoint="/testProcessEmails"
              data-method="GET"
            >
              <div class="form-group">
                <label for="count">Email Count (optional, default: 3, max: 20)</label>
                <input
                  type="number"
                  name="count"
                  id="count"
                  placeholder="3"
                  min="1"
                  max="20"
                />
              </div>
              <button type="submit" class="btn btn-warning">
                Run Test Processing
              </button>
            </form>
            <div class="result hidden"></div>
          </section>

          <section class="endpoint-card">
            <h2>üì• Process Email Queue</h2>
            <p>Start async processing of unprocessed emails in the queue.</p>
            <form
              class="endpoint-form"
              data-endpoint="/processEmailQueue"
              data-method="POST"
            >
              <div class="form-group">
                <label for="limit">Batch Limit (optional)</label>
                <input
                  type="number"
                  name="limit"
                  id="limit"
                  placeholder="10"
                  min="1"
                  max="100"
                />
              </div>
              <button type="submit" class="btn btn-primary">
                Start Queue Processing
              </button>
            </form>
            <div class="result hidden"></div>
          </section>

          <section class="endpoint-card">
            <h2>üìä Get Process Status</h2>
            <p>Check the status of a processing job.</p>
            <form
              class="endpoint-form"
              data-endpoint="/getProcessStatus"
              data-method="GET"
            >
              <div class="form-group">
                <label for="jobId">Job ID</label>
                <input
                  type="text"
                  name="jobId"
                  id="jobId"
                  placeholder="Enter job ID"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary">
                Check Status
              </button>
            </form>
            <div class="result hidden"></div>
          </section>

          <section class="endpoint-card">
            <h2>üîÑ Unprocess All Emails</h2>
            <p>Reset all emails to unprocessed state (for testing).</p>
            <form
              class="endpoint-form"
              data-endpoint="/unprocessAllEmails"
              data-method="POST"
            >
              <button type="submit" class="btn btn-danger">
                Reset All Emails
              </button>
            </form>
            <div class="result hidden"></div>
          </section>

          <section class="endpoint-card info-card">
            <h2>üì° Gmail Webhook</h2>
            <p>
              This endpoint receives push notifications from Gmail. It's
              automatically triggered by Google's Pub/Sub.
            </p>
            <div class="info-box">
              <strong>Endpoint:</strong> <code id="webhookUrl"></code>
            </div>
          </section>
        </div>
      </div>

      <footer>
        <p>
          OneFinance Gmail Integration ‚Ä¢ Secured with Firebase Authentication
        </p>
      </footer>
    </div>

    <script type="module" src="/js/app.js"></script>
  </body>
</html>
